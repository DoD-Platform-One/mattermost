{{- if or .Values.mattermostEnvs .Values.sso.enabled .Values.minio.install }}
apiVersion: v1
kind: Secret
metadata:
  name: mattermost-envs
  namespace: {{ .Release.Namespace }}
  labels:
    {{ include "mattermost.labels" . | nindent 4 }}
    app.kubernetes.io/component: "envs"
  annotations:
    "helm.sh/hook": "pre-install,pre-upgrade"
type: Opaque
stringData:
  {{- if .Values.mattermostEnvs }}
  {{ tpl (toYaml .Values.mattermostEnvs) . | nindent 2}}
  {{- end }}
  {{- if .Values.sso.enabled }}
  MM_GITLABSETTINGS_ENABLE: "{{ .Values.sso.enabled }}"
  MM_GITLABSETTINGS_ID: "{{ .Values.sso.client_id }}"
  MM_GITLABSETTINGS_SECRET: "{{ .Values.sso.client_secret }}"
  MM_GITLABSETTINGS_AUTHENDPOINT: "{{ .Values.sso.auth_endpoint }}"
  MM_GITLABSETTINGS_TOKENENDPOINT: "{{ .Values.sso.token_endpoint }}"
  MM_GITLABSETTINGS_USERAPIENDPOINT: "{{ .Values.sso.user_api_endpoint }}"
  {{- end }}
  {{- if .Values.minio.install }}
  MM_FILESETTINGS_AMAZONS3SSL: "false"
  {{- end }}
{{- end }}
